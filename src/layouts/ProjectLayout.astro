---
import Layout from "./Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { Image } from "astro:assets";
import { BadgeInfo, Github, Linkedin } from "@lucide/astro";

const { project } = Astro.props;
const {
    title,
    oneLiner,
    description,
    category,
    tags,
    problemStatement,
    targetAudience,
    detailedDescription,
    techStack,
    links,
    media,
    hackathon,
    isOpenSource,
    team,
} = project;
---

<Layout title={`${title} | GDG Projects`} description={oneLiner}>
    <Header />

    <main
        class="pt-[8rem] md:pt-[12rem] pb-24 px-6 md:px-12 lg:px-24 max-w-7xl mx-auto"
    >
        <!-- 1Ô∏è‚É£ Project Overview -->
        <header class="flex flex-col items-start mb-16">
            <div class="flex flex-wrap items-center gap-3 mb-6">
                <span
                    class="px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"
                >
                    {category}
                </span>
                {
                    isOpenSource && (
                        <span class="px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">
                            Open Source
                        </span>
                    )
                }
                {
                    hackathon?.name && (
                        <span class="px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400">
                            üèÜ {hackathon.name}
                        </span>
                    )
                }
            </div>

            <h1
                class="text-4xl md:text-6xl font-extrabold mb-6 tracking-tight leading-tight"
            >
                {title}
            </h1>
            <p
                class="text-md md:text-lg text-gray-600 dark:text-gray-400 font-medium w-full leading-relaxed"
            >
                {oneLiner}
            </p>
        </header>

        <!-- Hero Gallery/Media -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-20">
            <div class="lg:col-span-8">
                <div
                    class="w-full aspect-[16/9] rounded-[2.5rem] overflow-hidden bg-gray-100 dark:bg-gray-800 shadow-2xl group transition-all duration-500 relative"
                >
                    {
                        (media.screenshots &&
                            media.screenshots.filter((s: string) => s !== "")
                                .length > 1) ? (
                            <div class="relative w-full h-full group/carousel">
                                <div
                                    id="carousel-track"
                                    class="flex h-full transition-transform duration-700 ease-in-out"
                                >
                                    {media.screenshots
                                        .filter((s: string) => s !== "")
                                        .map((s: string, idx: number) => (
                                            <div class="min-w-full h-full flex-shrink-0">
                                                <Image
                                                    src={s}
                                                    alt={`${title} screenshot ${idx + 1}`}
                                                    class="w-full h-full object-cover"
                                                    width={1200}
                                                    height={675}
                                                />
                                            </div>
                                        ))}
                                </div>

                                <!-- Navigation Buttons -->
                                <button
                                    id="prev-slide"
                                    class="absolute left-6 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 backdrop-blur-md border border-white/30 text-white flex items-center justify-center lg:opacity-0 lg:group-hover/carousel:opacity-100 opacity-100 transition-all hover:bg-white/40 z-10"
                                    aria-label="Previous slide"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke-width="2.5"
                                        stroke="currentColor"
                                        class="w-6 h-6"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            d="M15.75 19.5L8.25 12l7.5-7.5"
                                        />
                                    </svg>
                                </button>
                                <button
                                    id="next-slide"
                                    class="absolute right-6 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 backdrop-blur-md border border-white/30 text-white flex items-center justify-center lg:opacity-0 lg:group-hover/carousel:opacity-100 opacity-100 transition-all hover:bg-white/40 z-10"
                                    aria-label="Next slide"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke-width="2.5"
                                        stroke="currentColor"
                                        class="w-6 h-6"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            d="M8.25 4.5l7.5 7.5-7.5 7.5"
                                        />
                                    </svg>
                                </button>

                                <!-- Indicators -->
                                <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-10">
                                    {media.screenshots
                                        .filter((s: string) => s !== "")
                                        .map((_: any, idx: number) => (
                                            <button
                                                class="carousel-dot w-2 h-2 rounded-full bg-white/30 transition-all hover:bg-white/60"
                                                data-index={idx}
                                                aria-label={`Go to slide ${idx + 1}`}
                                            />
                                        ))}
                                </div>
                            </div>
                        ) : (
                            <Image
                                src={media.thumbnail}
                                alt={title}
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                width={1200}
                                height={675}
                            />
                        )
                    }
                </div>
            </div>
            <div class="lg:col-span-4 flex flex-col gap-6">
                <div
                    class="p-8 rounded-[2rem] bg-gray-50 dark:bg-gray-800/40 border border-gray-100 dark:border-white/5 h-full"
                >
                    <h3
                        class="text-xs font-bold mb-6 text-gray-400 dark:text-gray-500 uppercase tracking-widest"
                    >
                        Project Links
                    </h3>
                    <div class="flex flex-col gap-4">
                        {
                            links.live && (
                                <a
                                    href={links.live}
                                    target="_blank"
                                    class="flex items-center justify-between p-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-bold transition-all hover:scale-[1.02]"
                                >
                                    Live Demo
                                    <BadgeInfo/>
                                </a>
                            )
                        }
                        {
                            links.github && (
                                <a
                                    href={links.github}
                                    target="_blank"
                                    class="flex items-center justify-between p-4 bg-gray-900 border border-gray-800 text-white rounded-2xl font-bold transition-all hover:scale-[1.02]"
                                >
                                    Github Repo
                                    <Github/>
                                </a>
                            )
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="flex flex-col gap-16">
            <div class="w-full">
                {problemStatement && (
                <section class="mb-16">
                    <h2
                        class="text-3xl font-bold mb-6 text-gray-900 dark:text-white"
                    >
                        The Problem
                    </h2>
                    <p
                        class="text-md md:text-lg text-gray-600 dark:text-gray-400 leading-relaxed"
                    >
                        {problemStatement}
                    </p>
                </section>
                )}
                {targetAudience && (
                    <section class="mb-16">
                    <h2
                        class="text-3xl font-bold mb-6 text-gray-900 dark:text-white"
                    >
                        Target Audience
                    </h2>
                    <p
                        class="text-md md:text-lg text-gray-600 dark:text-gray-400 leading-relaxed"
                    >
                        {targetAudience}
                    </p>
                </section>
                )}
                {detailedDescription && (
                <section class="mb-16">
                    <h2
                        class="text-3xl font-bold mb-6 text-gray-900 dark:text-white"
                    >
                        Project Details
                    </h2>
                    <div
                        class="text-md md:text-lg project-content text-gray-600 dark:text-gray-400 leading-relaxed"
                    >
                        {detailedDescription || description}
                    </div>
                </section>
                )}
                {
                    media.video &&
                        media.video !== "" &&
                        media.video !== "#" && (
                            <section class="mb-16">
                                <h2 class="text-3xl font-bold mb-8 text-gray-900 dark:text-white">
                                    Glimpse
                                </h2>
                                <div class="rounded-[2.5rem] overflow-hidden shadow-2xl">
                                    {media.video.includes(
                                        "drive.google.com",
                                    ) ? (
                                        <iframe
                                            src={media.video
                                                .replace(
                                                    "/view?usp=sharing",
                                                    "/preview",
                                                )
                                                .replace("/view", "/preview")}
                                            class="w-full aspect-video border-none"
                                            allow="autoplay"
                                            allowfullscreen
                                        />
                                    ) : (
                                        <video
                                            src={media.video}
                                            controls
                                            class="w-full aspect-video object-cover"
                                        >
                                            Your browser does not support the
                                            video tag.
                                        </video>
                                    )}
                                </div>
                            </section>
                        )
                }

            </div>

            <!-- Sidebar Info moved to bottom in 2 columns -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 pt-16 border-t border-gray-100 dark:border-white/5">
                <!-- Tech Stack -->
                <section>
                    <h3
                        class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6"
                    >
                        Tech Stack
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        {
                            techStack.languages?.map((lang: any) => (
                                <span class="px-4 py-2 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-xl text-sm font-bold border border-red-100 dark:border-red-900/50">
                                    {lang}
                                </span>
                            ))
                        }
                        {
                            techStack.frameworks?.map((fw: unknown) => (
                                <span class="px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-xl text-sm font-bold border border-blue-100 dark:border-blue-900/50">
                                    {fw}
                                </span>
                            ))
                        }
                        {
                            techStack.googleTechnologies?.map((gt: unknown) => (
                                <span class="px-4 py-2 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 rounded-xl text-sm font-bold border border-green-100 dark:border-green-900/50">
                                    {gt}
                                </span>
                            ))
                        }
                        {
                            techStack.others?.map((o: unknown) => (
                                <span class="px-4 py-2 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400 rounded-xl text-sm font-bold border border-yellow-100 dark:border-yellow-900/50">
                                    {o}
                                </span>
                            ))
                        }
                    </div>
                </section>

                <!-- Team & Contributors -->
                <section>
                    <h3
                        class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6"
                    >
                        {team.type}
                    </h3>
                    <div class="space-y-6">
                        {
                            team.contributors.map(
                                (member: {
                                    name: unknown;
                                    role: unknown;
                                    gdgRole: unknown;
                                    yearBranch: any;
                                    github: string | URL | null | undefined;
                                    linkedin: string | URL | null | undefined;
                                }) => (
                                    <div class="group p-6 rounded-3xl bg-gray-50 dark:bg-gray-800/40 border border-gray-100 dark:border-white/5 transition-all hover:border-blue-500/30">
                                        <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-1">
                                            {member.name}
                                        </h4>
                                        <p class="text-sm text-blue-600 dark:text-blue-400 font-bold mb-3">
                                            {member.role}
                                        </p>

                                        <div class="flex items-center justify-between mt-4">
                                            <span class="text-xs text-gray-500 dark:text-gray-500 font-medium">
                                                {member.gdgRole}
                                                {member.yearBranch &&
                                                    ` ‚Ä¢ ${member.yearBranch}`}
                                            </span>
                                            <div class="flex gap-3">
                                                {member.github && (
                                                    <a
                                                        href={member.github}
                                                        target="_blank"
                                                        class="text-gray-400 hover:text-black dark:hover:text-white transition-colors"
                                                    >
                                                        <Github/>
                                                    </a>
                                                )}
                                                {member.linkedin && (
                                                    <a
                                                        href={member.linkedin}
                                                        target="_blank"
                                                        class="text-gray-400 hover:text-blue-600 transition-colors"
                                                    >
                                                        <Linkedin/>
                                                    </a>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ),
                            )
                        }
                    </div>
                </section>
            </div>
        </div>
    </main>

    <Footer />

    <script>
        const track = document.getElementById("carousel-track");
        const prevBtn = document.getElementById("prev-slide");
        const nextBtn = document.getElementById("next-slide");
        const dots = document.querySelectorAll(".carousel-dot");

        if (track && prevBtn && nextBtn) {
            let currentSlide = 0;
            const slides = track.children;
            const totalSlides = slides.length;

            const updateCarousel = (index: number) => {
                currentSlide = (index + totalSlides) % totalSlides;
                track.style.transform = `translateX(-${currentSlide * 100}%)`;

                // Update dots
                dots.forEach((dot, i) => {
                    if (i === currentSlide) {
                        dot.classList.add("bg-white", "w-6");
                        dot.classList.remove("bg-white/30");
                    } else {
                        dot.classList.remove("bg-white", "w-6");
                        dot.classList.add("bg-white/30");
                    }
                });
            };

            // Initialize dots
            updateCarousel(0);

            prevBtn.addEventListener("click", () =>
                updateCarousel(currentSlide - 1),
            );
            nextBtn.addEventListener("click", () =>
                updateCarousel(currentSlide + 1),
            );

            dots.forEach((dot) => {
                dot.addEventListener("click", () => {
                    const index = parseInt(
                        dot.getAttribute("data-index") || "0",
                    );
                    updateCarousel(index);
                });
            });

            // Auto-play
            let interval = setInterval(() => updateCarousel(currentSlide + 1), 5000);

            // Pause on hover
            const container = track.parentElement;
            if (container) {
                container.addEventListener("mouseenter", () => clearInterval(interval));
                container.addEventListener("mouseleave", () => {
                    interval = setInterval(() => updateCarousel(currentSlide + 1), 5000);
                });
            }
        }
    </script>
</Layout>

<style is:global>
    .project-content {
        font-size: 1.125rem;
        line-height: 1.8;
    }

    .project-content h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #111827;
    }

    .dark .project-content h3 {
        color: #f9fafb;
    }

    .project-content p {
        margin-bottom: 1.5rem;
    }

    .project-content ul {
        list-style-type: disc;
        margin-left: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .project-content li {
        margin-bottom: 0.5rem;
    }
</style>
