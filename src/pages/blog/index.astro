---
import { getCollection } from "astro:content";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import "../../styles/global.css";
import { Image } from "astro:assets";

const blogs = await getCollection("blog");
const sortedBlogs = blogs.sort(
    (a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const categories = ["All", ...new Set(blogs.map((b: any) => b.data.category))];
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />
        <title>Blog | GDG</title>
    </head>
    <body class="bg-white dark:bg-[#0B0D17] text-gray-900 dark:text-white">
        <Header />

        <main
            class="pt-[8rem] md:pt-[12rem] pb-[10rem] px-6 md:px-12 -mt-[2rem] lg:px-24 max-w-7xl mx-auto"
        >
            <h2
                class="text-4xl text-center md:text-6xl font-bold mb-4 tracking-tight text-gray-900 dark:text-white"
            >
                Insights & stories from our <span
                    class="text-blue-500 dark:text-blue-400">C</span
                ><span class="text-red-500 dark:text-red-400">L</span><span
                    class="text-[#FBBC04] dark:text-yellow-400">U</span
                ><span class="text-green-500 dark:text-green-400">B</span>
            </h2>
            <p
                class="text-gray-600 dark:text-gray-400 text-lg md:text-xl max-w-2xl mx-auto text-center mb-[3rem]"
            >
                Read about our latest experiences, technical deep-dives, and
                community updates.
            </p>

            <!-- Category Filter -->
            <div
                class="flex items-center gap-8 border-b border-gray-100 dark:border-white/5 mb-20 overflow-x-auto no-scrollbar"
            >
                {
                    categories.map((cat: any, i: number) => (
                        <button
                            class={`pb-6 text-sm font-bold uppercase tracking-widest transition-all relative ${i === 0 ? "text-blue-500" : "text-[#3C3C43]/50 dark:text-white/40 hover:text-gray-900 dark:hover:text-white"}`}
                        >
                            {cat}
                            {i === 0 && (
                                <span class="absolute bottom-0 left-0 w-full h-[2px] bg-blue-500" />
                            )}
                        </button>
                    ))
                }
            </div>

            <!-- Blogs Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-16 gap-y-24">
                {
                    sortedBlogs.map((post: any) => (
                        <a
                            href={`/blog/${post.slug}`}
                            class="group flex flex-col md:flex-row gap-8 items-start"
                        >
                            <div class="flex-1 order-2 md:order-1">
                                <h2 class="text-3xl font-bold mb-4 group-hover:text-blue-500 transition-colors leading-snug">
                                    {post.data.title}
                                </h2>
                                <div class="flex items-center gap-3 text-xs font-bold uppercase tracking-widest text-[#3C3C43]/50 dark:text-white/60">
                                    <span>
                                        {new Date(
                                            post.data.pubDate,
                                        ).toLocaleDateString("en-US", {
                                            day: "numeric",
                                            month: "short",
                                            year: "numeric",
                                        })}
                                    </span>
                                    <span>{post.data.category}</span>
                                    <span class="flex items-center gap-1 group-hover:text-blue-500 transition-colors">
                                        Read
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke-width="3"
                                            stroke="currentColor"
                                            class="w-3 h-3 transition-transform group-hover:translate-x-1"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                d="m8.25 4.5 7.5 7.5-7.5 7.5"
                                            />
                                        </svg>
                                    </span>
                                </div>
                            </div>

                            <div class="w-full md:w-56 aspect-square rounded-[2rem] overflow-hidden order-1 md:order-2 bg-gradient-to-br from-blue-500/20 to-purple-600/20 dark:from-blue-500/10 dark:to-purple-600/10 flex-shrink-0 relative">
                                <Image
                                    src={post.data.image}
                                    alt={post.data.title}
                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 relative z-10"
                                    onerror="this.style.opacity='0'"
                                    width={100}
                                    height={100}
                                    fetchpriority="high"
                                />
                                <div class="absolute inset-0 flex items-center justify-center text-blue-500 font-bold text-4xl opacity-20">
                                    {post.data.title.charAt(0)}
                                </div>
                            </div>
                        </a>
                    ))
                }
            </div>
        </main>

        <Footer />
    </body>
</html>

<style>
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>
