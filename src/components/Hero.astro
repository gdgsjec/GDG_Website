---
import "../styles/global.css";
import { Image } from "astro:assets";
import { ChevronRight } from "@lucide/astro";
---

<section
  class="relative min-h-screen flex flex-col items-center justify-center overflow-hidden bg-white dark:bg-[#0B0D17] font-sans"
>
  <!-- Subtle Grid Background -->
  <div
    class="absolute inset-0 z-0 opacity-[0.05] dark:opacity-[0.1]"
    style="background-image: linear-gradient(#4285F4 1px, transparent 1px), linear-gradient(90deg, #4285F4 1px, transparent 1px); background-size: 80px 80px;"
  >
  </div>

  <!-- Large Background Angled Logo -->
  <div
    id="hero-bg-logo"
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 opacity-[0.15] dark:opacity-[0.2] pointer-events-none transform rotate-[-20deg] scale-[2] md:scale-[3]"
  >
    <Image
      src="/images/GDG_LOGO.webp"
      alt=""
      class="w-[400px] h-auto filter invert dark:invert-0"
      width={100}
      height={100}
      fetchpriority="high"
    />
  </div>

  <!-- Decorative Blobs -->
  <div
    id="blob-1"
    class="absolute top-[20%] -left-20 w-[400px] h-[400px] bg-blue-500/10 dark:bg-blue-400/5 rounded-full blur-[120px] animate-pulse pointer-events-none"
  >
  </div>
  <div
    id="blob-2"
    class="absolute top-[40%] -right-20 w-[400px] h-[400px] bg-red-500/10 dark:bg-red-400/5 rounded-full blur-[120px] animate-pulse pointer-events-none"
    style="animation-delay: 3s;"
  >
  </div>

  <div class="container mx-auto px-6 relative z-10 flex flex-col items-center">
    <!-- Main Heading -->
    <div class="max-w-5xl text-center pt-20 line-height-tight">
      <h1
        id="hero-title"
        class="text-5xl md:text-8xl lg:text-9xl font-bold text-gray-900 dark:text-white leading-[1.1] md:leading-[1] tracking-tighter mb-8"
      >
        <span class="inline-block">Connect.</span>
        <br class="hidden md:block" />
        <span class="inline-block">Build.</span>
        <span class="inline-block whitespace-nowrap">
          <span class="text-blue-500 dark:text-blue-400">G</span><span
            class="text-red-500 dark:text-red-400">r</span
          ><span class="text-yellow-400 dark:text-yellow-400">o</span><span
            class="text-green-500 dark:text-green-400">w.</span
          >
        </span>
      </h1>

      <!-- Subtext -->
      <p
        id="hero-subtext"
        class="max-w-xl mx-auto text-lg md:text-xl text-gray-600 dark:text-gray-400 leading-relaxed mb-12"
      >
        Bridging the gap between theory and practice at <span
          class="font-bold text-gray-900 dark:text-gray-100"
          >GDG on Campus SJEC</span
        >. The official student developer community.
      </p>

      <!-- Call to Action -->
      <div
        id="hero-cta"
        class="flex flex-col sm:flex-row items-center justify-center gap-6"
      >
        <a
          href="https://gdg.community.dev/gdg-on-campus-st-joseph-engineering-college-mangaluru-india/"
          target="_blank"
          class="group px-10 py-4 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold rounded-full hover:scale-105 active:scale-95 transition-all duration-300 shadow-2xl flex items-center gap-2"
        >
          Join Chapter
          <ChevronRight />
        </a>
        <a
          href="#about"
          class="px-10 py-4 border border-gray-200 dark:border-gray-800 text-gray-900 dark:text-white font-bold rounded-full hover:bg-gray-50 dark:hover:bg-white/5 transition-all duration-300"
        >
          Learn More
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initAnimations() {
    // Kill any existing triggers to avoid duplicates on Astro swap
    ScrollTrigger.getAll().forEach((t) => t.kill());

    // Initial entrance animation
    const tl = gsap.timeline({
      defaults: { ease: "power4.out", duration: 1.2 },
    });

    // Reset properties before animation to ensure clean start
    gsap.set(["#hero-title span", "#hero-subtext", "#hero-cta"], {
      opacity: 0,
      y: 50,
    });

    tl.to("#hero-title span", {
      y: 0,
      opacity: 1,
      stagger: 0.1,
    })
      .to(
        "#hero-subtext",
        {
          y: 0,
          opacity: 1,
        },
        "-=0.8",
      )
      .to(
        "#hero-cta",
        {
          y: 0,
          opacity: 1,
        },
        "-=0.6",
      );

    // Scroll-triggered animations - using gsap.to but ensuring we start from current state
    const scrollTl = gsap.timeline({
      scrollTrigger: {
        trigger: "section",
        start: "top top",
        end: "bottom top",
        scrub: 1, // Direct scrub for better smoothness control
        invalidateOnRefresh: true,
      },
    });

    scrollTl
      .to(
        "#hero-title",
        {
          y: 100,
          scale: 0.9,
          opacity: 0,
          filter: "blur(10px)",
          ease: "none",
        },
        0,
      )
      .to(
        "#hero-subtext",
        {
          y: 80,
          opacity: 0,
          ease: "none",
        },
        0,
      )
      .to(
        "#hero-cta",
        {
          y: 60,
          opacity: 0,
          ease: "none",
        },
        0,
      )
      .to(
        "#hero-bg-logo",
        {
          rotate: -15,
          y: -150,
          scale: 4.5,
          opacity: 0.05,
          ease: "none",
        },
        0,
      );

    // Parallax for blobs with slightly different speeds
    gsap.to("#blob-1", {
      scrollTrigger: {
        trigger: "section",
        start: "top top",
        end: "bottom top",
        scrub: 2,
      },
      y: -300,
      x: -150,
      ease: "none",
    });

    gsap.to("#blob-2", {
      scrollTrigger: {
        trigger: "section",
        start: "top top",
        end: "bottom top",
        scrub: 2.5,
      },
      y: -250,
      x: 150,
      ease: "none",
    });
  }

  // Handle initialization and Astro lifecycle
  if (document.readyState === "complete") {
    initAnimations();
  } else {
    window.addEventListener("load", initAnimations);
  }

  document.addEventListener("astro:after-swap", initAnimations);

  // Refresh ScrollTrigger on resize to handle orientation/browser changes
  window.addEventListener("resize", () => ScrollTrigger.refresh());
</script>

<style>
  @keyframes float {
    0%,
    100% {
      transform: translateY(0) rotate(0);
    }
    50% {
      transform: translateY(-15px) rotate(2deg);
    }
  }

  .animate-float {
    animation: float 8s ease-in-out infinite;
  }

  section {
    font-family: "Google Sans", sans-serif;
  }

  /* Ensure no layout shift for spans */
  #hero-title span {
    display: inline-block;
  }
</style>
