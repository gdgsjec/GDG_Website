---
import { Image } from "astro:assets";
---

<section
  id="about"
  class="bg-white dark:bg-[#0B0D17] font-sans overflow-hidden"
>
  <!-- Hero Section (Revealing) -->
  <div
    id="about-hero"
    class="relative w-full h-[100vh] flex items-center justify-center"
  >
    <div class="absolute inset-0 z-0">
      <Image
        src="/images/hero-bg.webp"
        alt="GDG SJEC Team"
        class="w-full h-full object-cover opacity-100"
        width={1920}
        height={1080}
        fetchpriority="high"
      />
    </div>

    <!-- Apple Glass Reveal Container -->
    <div
      id="about-glass-card"
      class="relative z-10 h-full w-[90%] md:w-[70%] px-6 md:px-12 py-16 rounded-[40px]
             backdrop-blur-2xl bg-white/10 dark:bg-black/40
             border border-white/30 dark:border-white/10
             shadow-[0_20px_50px_rgba(0,0,0,0.3)]
             flex flex-col items-center justify-center text-center opacity-0 transform translate-y-20 overflow-hidden"
    >
      <h1
        id="about-revealing-title"
        class="text-4xl md:text-7xl lg:text-8xl font-bold text-white leading-[1.1] tracking-tighter"
      >
        We Build <br /> The Future <br /> Together
      </h1>
    </div>
  </div>

  <!-- Our Story Section -->
  <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-24 py-24 md:py-32">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-24">
      <div class="lg:col-span-5">
        <span
          class="text-blue-600 dark:text-blue-400 font-bold text-xl mb-6 block"
          >01/</span
        >
        <h2
          class="text-4xl md:text-6xl font-bold text-gray-900 dark:text-white leading-tight"
        >
          Our <br /> Story
        </h2>
      </div>
      <div class="lg:col-span-7">
        <p
          class="text-lg md:text-xl text-gray-600 dark:text-gray-400 leading-relaxed mb-8"
        >
          Driven by the ingenuity of Google Developers, the Google Developer
          Group (GDG) at St. Joseph Engineering College is a testament to our
          commitment to learning and growth. Whether you are new to coding or
          already tech-savvy, GDG is the club where you can turbocharge your
          programming skills and network with peers and experts.
        </p>
        <p
          class="text-lg md:text-xl text-gray-600 dark:text-gray-400 leading-relaxed"
        >
          We welcome students from all fields, guiding everyone from their first
          "Hello, World!" to advanced coding tricks and collaborative tech
          projects. Our vibrant club hosts activities, shares resources, and
          offers opportunities for learning in both technical and creative
          domains.
        </p>
      </div>
    </div>
  </div>

  <!-- Mission Section (Steps Design) -->
  <div class="bg-gray-50 dark:bg-white/[0.02] py-24 md:py-32">
    <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-24">
      <div class="mb-20">
        <span class="text-[#EA4335] font-bold text-xl mb-6 block">02/</span>
        <h2
          class="text-4xl md:text-6xl font-bold text-gray-900 dark:text-white"
        >
          Our Mission
        </h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-16">
        <!-- Step 1 -->
        <div class="group">
          <div class="flex items-center gap-4 mb-8">
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest ring-1 ring-gray-200 dark:ring-gray-800 px-2 py-1 rounded"
              >Step 01</span
            >
            <div class="h-[1px] flex-grow bg-gray-200 dark:bg-gray-800"></div>
          </div>
          <h3
            class="text-2xl font-bold text-gray-900 dark:text-white mb-6 group-hover:text-[#4285F4] transition-colors"
          >
            Technical Growth
          </h3>
          <ul class="space-y-4">
            {
              [
                "Web Development",
                "Android Development",
                "AIML",
                "Cloud Technologies",
                "Flutter",
                "UI/UX",
              ].map((item) => (
                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-400">
                  <div class="w-1 h-1 bg-blue-500 rounded-full" />
                  {item}
                </li>
              ))
            }
          </ul>
        </div>

        <!-- Step 2 -->
        <div class="group">
          <div class="flex items-center gap-4 mb-8">
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest ring-1 ring-gray-200 dark:ring-gray-800 px-2 py-1 rounded"
              >Step 02</span
            >
            <div class="h-[1px] flex-grow bg-gray-200 dark:bg-gray-800"></div>
          </div>
          <h3
            class="text-2xl font-bold text-gray-900 dark:text-white mb-6 group-hover:text-[#EA4335] transition-colors"
          >
            Creative Skills
          </h3>
          <ul class="space-y-4">
            {
              [
                "Operations & Events",
                "Campaign Coordination",
                "Media & Content Creation",
                "Program Coordination",
              ].map((item) => (
                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-400">
                  <div class="w-1 h-1 bg-red-500 rounded-full" />
                  {item}
                </li>
              ))
            }
          </ul>
        </div>

        <!-- Step 3 -->
        <div class="group">
          <div class="flex items-center gap-4 mb-8">
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest ring-1 ring-gray-200 dark:ring-gray-800 px-2 py-1 rounded"
              >Step 03</span
            >
            <div class="h-[1px] flex-grow bg-gray-200 dark:bg-gray-800"></div>
          </div>
          <h3
            class="text-2xl font-bold text-gray-900 dark:text-white mb-6 group-hover:text-[#34A853] transition-colors"
          >
            Global Opportunities
          </h3>
          <ul class="space-y-4">
            {
              [
                "Game Dev & UI/UX",
                "Global Resources",
                "Workshops",
                "Collaborative Community",
                "Cross-domain connection",
              ].map((item) => (
                <li class="flex items-center gap-3 text-gray-600 dark:text-gray-400">
                  <div class="w-1 h-1 bg-green-500 rounded-full" />
                  {item}
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Impact Section -->
  <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-24 py-24 md:py-32">
    <div
      class="flex flex-col lg:flex-row justify-between items-start gap-12 mb-20"
    >
      <div>
        <span class="text-[#FBBC04] font-bold text-xl mb-6 block">03/</span>
        <h2
          class="text-4xl md:text-6xl font-bold text-gray-900 dark:text-white"
        >
          Our Impact
        </h2>
      </div>
      <p
        class="max-w-md text-gray-600 dark:text-gray-400 text-lg leading-relaxed"
      >
        We measure our success by the growth of our members and the strength of
        our community.
      </p>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
      <div class="border-l-4 border-blue-500 pl-6 py-4">
        <div
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-2 counter"
          data-target="600"
        >
          0+
        </div>
        <div
          class="text-gray-500 dark:text-gray-500 font-bold uppercase tracking-widest text-xs"
        >
          Active Members
        </div>
      </div>
      <div class="border-l-4 border-red-500 pl-6 py-4">
        <div
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-2 counter"
          data-target="20"
        >
          0+
        </div>
        <div
          class="text-gray-500 dark:text-gray-500 font-bold uppercase tracking-widest text-xs"
        >
          Sessions
        </div>
      </div>
      <div class="border-l-4 border-yellow-500 pl-6 py-4">
        <div
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-2 counter"
          data-target="12"
        >
          0+
        </div>
        <div
          class="text-gray-500 dark:text-gray-500 font-bold uppercase tracking-widest text-xs"
        >
          Expert Speakers
        </div>
      </div>
      <div class="border-l-4 border-green-500 pl-6 py-4">
        <div
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-2 counter"
          data-target="10"
        >
          0+
        </div>
        <div
          class="text-gray-500 dark:text-gray-500 font-bold uppercase tracking-widest text-xs"
        >
          Workshops
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initAboutAnimations() {
    // Kill existing triggers
    ScrollTrigger.getAll()
      .filter(
        (st) =>
          st.vars.trigger === "#about" || st.vars.trigger === "#about-hero",
      )
      .forEach((st) => st.kill());

    // Timeline for the pinned hero reveal
    const heroTl = gsap.timeline({
      scrollTrigger: {
        trigger: "#about-hero",
        start: "top top",
        end: "+=250%", // Longer pin for more dramatic expansion
        pin: true,
        scrub: 1,
        anticipatePin: 1,
      },
    });

    // Reveal and Expand the glass card
    heroTl
      .to("#about-glass-card", {
        y: 0,
        opacity: 1,
        duration: 2,
        ease: "power2.out",
      })
      .to("#about-glass-card", {
        width: "100vw",
        height: "100vh",
        borderRadius: 0,
        backgroundColor: "rgba(0, 0, 0, 0.4)",
        borderWidth: 0,
        duration: 4,
        ease: "none",
      })
      // Subtle scale up of the background image while pinned
      .to(
        "#about-hero img",
        {
          scale: 1.15,
          duration: 6,
          ease: "none",
        },
        0,
      );

    // Parallax for the images in the rest of the section
    gsap.utils.toArray(".parallax-img").forEach((img: any) => {
      gsap.to(img, {
        scrollTrigger: {
          trigger: img,
          start: "top bottom",
          scrub: true,
        },
        y: -50,
      });
    });

    // Handle Counters
    function animateCounter(el: any) {
      const target = parseInt(el.getAttribute("data-target"));
      const duration = 2000;
      const start = 0;
      let startTime: number | null = null;

      function step(timestamp: number) {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1);
        const current = Math.floor(progress * (target - start) + start);
        el.textContent = current + "+";
        if (progress < 1) {
          window.requestAnimationFrame(step);
        } else {
          el.textContent = target + "+";
        }
      }
      window.requestAnimationFrame(step);
    }

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateCounter(entry.target);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.5 },
    );

    document.querySelectorAll(".counter").forEach((counter) => {
      observer.observe(counter);
    });
  }

  // Initialize
  if (document.readyState === "complete") {
    initAboutAnimations();
  } else {
    window.addEventListener("load", initAboutAnimations);
  }

  document.addEventListener("astro:after-swap", initAboutAnimations);
</script>

<style>
  section {
    font-family: "Google Sans", sans-serif;
  }

  #about-glass-card {
    /* Manual glassmorphism refinements for extra "Apple" feel */
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  }
</style>
