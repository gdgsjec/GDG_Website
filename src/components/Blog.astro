---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const blogs = await getCollection("blog");
const sortedBlogs = blogs.sort(
  (a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<section
  id="blogs-section"
  class="bg-white dark:bg-[#0B0D17] py-24 px-6 md:px-12 lg:px-24 font-sans overflow-hidden"
>
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-20">
      <h2 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight text-gray-900 dark:text-white">
        Insights & stories from our <span
          class="text-blue-500 dark:text-blue-400">C</span
        ><span class="text-red-500 dark:text-red-400">L</span><span
          class="text-[#FBBC04] dark:text-yellow-400">U</span
        ><span class="text-green-500 dark:text-green-400">B</span>
      </h2>
      <p class="text-gray-600 dark:text-gray-400 text-lg md:text-xl max-w-2xl mx-auto">
        Read about our latest experiences, technical deep-dives, and community updates.
      </p>
    </div>

    <!-- Blog Container with Horizontal Scroll -->
    <div
      id="blog-slider"
      class="flex overflow-x-auto snap-x snap-mandatory gap-8 lg:gap-10 pb-8 no-scrollbar scroll-smooth px-4"
    >
      {
        sortedBlogs.map((blog: any) => (
          <div class="group flex-none w-[85%] sm:w-[45%] lg:w-[31%] xl:w-[23%] snap-start flex flex-col">
            <!-- Featured Image -->
            <div class="relative aspect-square w-full mb-8 overflow-hidden rounded-[2.5rem] bg-gray-100 dark:bg-gray-800/50 shadow-sm border border-gray-100 dark:border-gray-800">
              <Image
                src={blog.data.image}
                alt={blog.data.title}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                loading="lazy"
                width={1920}
                height={1080}
                fetchpriority="high"
              />
              <div class="absolute inset-0 bg-black/5 dark:bg-white/[0.02] group-hover:opacity-0 transition-opacity" />
            </div>

            <!-- Blog Info -->
            <div class="flex flex-col flex-grow">
              <h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-4 leading-[1.3] group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300 min-h-[3.5rem] line-clamp-2">
                {blog.data.title}
              </h3>

              <div class="flex items-center gap-2.5 text-gray-500 dark:text-gray-400 text-xs font-semibold mb-6 uppercase tracking-widest">
                <span>
                  {new Date(blog.data.pubDate).toLocaleDateString("en-US", {
                    day: "numeric",
                    month: "short",
                    year: "numeric",
                  })}
                </span>
                <span class="w-1 h-1 bg-gray-300 dark:bg-gray-700 rounded-full" />
                <span class="truncate">{blog.data.author}</span>
              </div>

              <div class="mt-auto">
                <a
                  href={`/blog/${blog.slug}`}
                  class="inline-flex items-center text-lg font-bold text-gray-900 dark:text-white group/link transition-colors"
                >
                  <span class="border-b-2 border-transparent group-hover/link:border-blue-600 dark:group-hover/link:border-blue-400">
                    Read blog
                  </span>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="3"
                    stroke="currentColor"
                    class="w-4 h-4 ml-2 transition-transform group-hover/link:translate-x-1.5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m8.25 4.5 7.5 7.5-7.5 7.5"
                    />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Navigation Arrows -->
    <div class="flex items-center gap-4 mt-12 px-4">
      <button
        id="prev-blog"
        aria-label="Previous blog"
        class="p-3 border border-gray-200 dark:border-gray-800 rounded-full text-gray-400 dark:text-gray-600 hover:text-black dark:hover:text-white hover:border-black dark:hover:border-white transition-all duration-300 focus:outline-none"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2.5"
          stroke="currentColor"
          class="w-5 h-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 19.5 8.25 12l7.5-7.5"></path>
        </svg>
      </button>
      <button
        id="next-blog"
        aria-label="Next blog"
        class="p-3 border border-gray-200 dark:border-gray-800 rounded-full text-gray-400 dark:text-gray-600 hover:text-black dark:hover:text-white hover:border-black dark:hover:border-white transition-all duration-300 focus:outline-none"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2.5"
          stroke="currentColor"
          class="w-5 h-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m8.25 4.5 7.5 7.5-7.5 7.5"></path>
        </svg>
      </button>
    </div>

    <!-- View All Button -->
    <div class="flex justify-center mt-16">
      <a
        href="/blog"
        class="group px-6 py-2.5 md:px-8 md:py-3.5 border border-gray-200 dark:border-gray-800 rounded-full text-sm md:text-base font-bold text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-white/5 transition-all duration-300"
      >
        Explore all blogs
      </a>
    </div>
  </div>
</section>

<script>
  const slider = document.getElementById("blog-slider");
  const nextBtn = document.getElementById("next-blog");
  const prevBtn = document.getElementById("prev-blog");

  if (slider && nextBtn && prevBtn) {
    nextBtn.addEventListener("click", () => {
      const cardWidth = slider.querySelector(".group")?.clientWidth || 300;
      slider.scrollBy({ left: cardWidth + 32, behavior: "smooth" });
    });

    prevBtn.addEventListener("click", () => {
      const cardWidth = slider.querySelector(".group")?.clientWidth || 300;
      slider.scrollBy({ left: -(cardWidth + 32), behavior: 'smooth' });
    });
  }
</script>

<style>
  section {
    font-family: var(--font-sans, "Google Sans", "Inter", sans-serif);
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .no-scrollbar {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
</style>
